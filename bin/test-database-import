#!/bin/sh

set -e; set -u
. "$(dirname $0)/common"

dump_file="${1:-}"

if [ -z "$dump_file" -o ! -f "$dump_file" ]; then
    echo "You should provide valid path to database dump file"
    exit 1
fi

write_title "Importing dump"
zcat < "$dump_file" | mysql \
    $(get_switch "-u " "$(read_env_parameter DATABASE_USER root)") \
    $(get_switch "-p" "$(read_env_parameter DATABASE_PASSWORD)") \
    $(get_switch "-h " "$(read_env_parameter DATABASE_HOST localhost)") \
    $(get_switch "-P " "$(read_env_parameter DATABASE_PORT 3306)") \
    "$(read_env_parameter DATABASE_NAME)"
